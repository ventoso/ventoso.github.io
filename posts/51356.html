<!DOCTYPE html><html lang="zh-CN"><head><title>为你的 hexo 开启 gulp 压缩加速 - Ventoso | 山丘</title><meta charset="UTF-8"><meta name="description" content="我一直试着去泰然处世。"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="baidu-site-verification" content="FaccXtoIXz"><link rel="shortcut icon" href="https://cdn.ventoso.top/wordpress/favicon.ico" type="image/png"><meta name="description" content="访问速度是最能体现访问者幸福值的，这是我所认为的，而 gulp 似乎可以让我稍微离幸福近一点"><meta property="og:type" content="article"><meta property="og:title" content="为你的 hexo 开启 gulp 压缩加速"><meta property="og:url" content="https://ventoso.top/posts/51356.html"><meta property="og:site_name" content="Ventoso | 山丘"><meta property="og:description" content="访问速度是最能体现访问者幸福值的，这是我所认为的，而 gulp 似乎可以让我稍微离幸福近一点"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-04-27T08:06:28.000Z"><meta property="article:modified_time" content="2020-04-27T09:32:20.000Z"><meta property="article:author" content="TniAsu"><meta property="article:tag" content="hexo"><meta property="article:tag" content="gulp"><meta property="article:tag" content="优化"><meta property="article:tag" content="加速"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/gh/ventoso/ventoso.github.io@1.0.1/css/style.css,npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/ventoso/ventoso.github.io@latest/lib/mdui_043tiny/css/mdui.css,gh/ventoso/ventoso.github.io@latest/lib/iconfont/iconfont.css" crossorigin><meta name="generator" content="Hexo 4.2.0"></head><body class="mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image:url(https://cdn.ventoso.top/river.jpg!lite)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div> <a href="/" title="TniAsu" class="mdui-btn mdui-btn-icon"><img src="https://cdn.ventoso.top/wordpress/avatar.png" alt="TniAsu"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer"><div class="nexmoe-avatar mdui-ripple"> <a href="/" title="TniAsu"><img src="https://cdn.ventoso.top/wordpress/avatar.png" alt="TniAsu" alt="TniAsu"></a></div><div class="nexmoe-count"><div><span>文章</span>11</div><div><span>标签</span>15</div><div><span>分类</span>2</div></div><div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}"><a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到主页"><i class="mdui-list-item-icon nexmoefont icon-home"></i><div class="mdui-list-item-content"> 回到主页</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives/" title="文章归档"><i class="mdui-list-item-icon nexmoefont icon-container"></i><div class="mdui-list-item-content"> 文章归档</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="何以为友"><i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i><div class="mdui-list-item-content"> 何以为友</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="何以为我"><i class="mdui-list-item-icon nexmoefont icon-info-circle"></i><div class="mdui-list-item-content"> 何以为我</div></a></div><aside id="nexmoe-sidebar"><div class="nexmoe-widget-wrap"><div class="nexmoe-widget nexmoe-search"><form id="search_form" action_e="https://cn.bing.com/search?q=site:ventoso.top" onsubmit="return search()"> <label><input id="search_value" name="q" type="search" placeholder="搜索"></label></form></div></div><div class="nexmoe-widget-wrap"><div class="nexmoe-widget nexmoe-social"><a class="mdui-ripple" href="https://space.bilibili.com/26525320" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color:#e76a8d;background-color:rgba(231,106,141,.15)"><i class="nexmoefont icon-bilibili"></i></a><a class="mdui-ripple" href="https://github.com/ventoso/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color:#191717;background-color:rgba(25,23,23,.15)"><i class="nexmoefont icon-github"></i></a><a class="mdui-ripple" href="/dist/docs/" target="_blank" mdui-tooltip="{content: 'Project'}" style="color:#e76a8d;background-color:rgba(231,106,141,.15)"><i class="nexmoefont icon-appstore-fill"></i></a><a class="mdui-ripple" href="/atom.xml" target="_blank" mdui-tooltip="{content: 'Rss'}" style="color:#191717;background-color:rgba(25,23,23,.15)"><i class="nexmoefont icon-rss"></i></a></div></div><div class="nexmoe-widget-wrap"><br><div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow"> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size:10px">C语言</a> <a href="/tags/arch/" style="font-size:10px">arch</a> <a href="/tags/gulp/" style="font-size:10px">gulp</a> <a href="/tags/hexo/" style="font-size:10px">hexo</a> <a href="/tags/linux/" style="font-size:12.5px">linux</a> <a href="/tags/manjaro/" style="font-size:12.5px">manjaro</a> <a href="/tags/sharlist/" style="font-size:10px">sharlist</a> <a href="/tags/something/" style="font-size:17.5px">something</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size:12.5px">云存储</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size:10px">优化</a> <a href="/tags/%E5%8A%A0%E9%80%9F/" style="font-size:10px">加速</a> <a href="/tags/%E5%A4%A9%E7%BF%BC%E4%BA%91/" style="font-size:10px">天翼云</a> <a href="/tags/%E6%89%8B%E6%9C%BA/" style="font-size:10px">手机</a> <a href="/tags/%E6%8A%98%E8%85%BE%E7%AC%94%E8%AE%B0/" style="font-size:20px">折腾笔记</a> <a href="/tags/%E9%9A%8F%E5%BF%83/" style="font-size:15px">随心</a></div><script>for(var maxTagcloud=parseInt(10),tags_length=parseInt(15),tags_arr=[],i=0;i<tags_length;i++)tags_arr.push(i);tags_arr.sort(function(a,t){return.5<Math.random()?-1:1}),tags_arr=tags_arr.slice(0,maxTagcloud<tags_length?tags_length-maxTagcloud:0);for(var tag_i=0;tag_i<tags_arr.length;tag_i++)document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display="none"</script></div><div class="nexmoe-widget-wrap"><div class="nexmoe-widget"><ul class="category-list"><li class="category-list-item"> <a class="category-list-link" href="/categories/Something/">Something</a> <span class="category-list-count">3</span></li><li class="category-list-item"> <a class="category-list-link" href="/categories/何为折腾/">何为折腾</a> <span class="category-list-count">8</span></li></ul></div></div></aside><div class="nexmoe-copyright"> &copy; 2020 TniAsu Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a><br><a href="http://www.beian.miit.gov.cn/?spm=a2c4g.11186623.2.16.1f331462AgLtxi" target="_blank">豫ICP备20004916号-1</a></div></div></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post"><div class="nexmoe-post-cover" style="padding-bottom:42.857142857142854%"> <img data-src="https://cdn.ventoso.top/bingdayimages/bing1.jpg!ven" data-sizes="auto" alt="为你的 hexo 开启 gulp 压缩加速" class="lazyload"></div><h2>为你的 hexo 开启 gulp 压缩加速</h2><div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important"><a><i class="nexmoefont icon-calendar-fill"></i> 2020年04月27日</a><a><i class="nexmoefont icon-areachart"></i> 1.1k 字</a><a><i class="nexmoefont icon-time-circle-fill"></i> 大概 5 分钟</a></div><div class="nexmoe-post-right"><div class="nexmoe-fixed"><div class="nexmoe-valign"><div class="nexmoe-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#先上方案"><span class="toc-number">1.</span> <span class="toc-text">先上方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#再说故事"><span class="toc-number">2.</span> <span class="toc-text">再说故事</span></a></li></ol></div></div></div></div><article><p>访问速度是最能体现访问者幸福值的，这是我所认为的，而 gulp 似乎可以让我稍微离幸福近一点</p><a id="more"></a><p>如上，博客的加速方案找了不少，今天就先说一下 gulp 压缩静态资源吧</p><h2 id="先上方案"><a href="#先上方案" class="headerlink" title="先上方案"></a>先上方案</h2><p>安装相关包</p><pre><code class="shell">npm install --global gulp-cli #全局安装 gulp-cli 命令行工具模块
npm install gulp --save #本地安装 gulp 插件
npm install gulp-htmlclean gulp-htmlmin gulp-clean-css gulp-uglify gulp-imagemin --save #安装 gulp 不同功能插件
npm install gulp-babel babel-preset-env babel-preset-mobx --save #安装编译压缩所需babel 插件
npm install -D @babel/core @babel/preset-react @babel/preset-env --save # 安装 babel 包</code></pre><p>检查 package.json</p><pre><code>  &quot;dependencies&quot;: {
    &quot;babel-preset-env&quot;: &quot;^1.7.0&quot;,
    &quot;babel-preset-mobx&quot;: &quot;^2.0.0&quot;,
    &quot;gulp&quot;: &quot;^4.0.2&quot;,
    &quot;gulp-babel&quot;: &quot;^8.0.0&quot;,
    &quot;gulp-clean-css&quot;: &quot;^4.2.0&quot;,
    &quot;gulp-htmlclean&quot;: &quot;^2.7.22&quot;,
    &quot;gulp-htmlmin&quot;: &quot;^5.0.1&quot;,
    &quot;gulp-imagemin&quot;: &quot;^7.1.0&quot;,
    &quot;gulp-uglify&quot;: &quot;^3.0.2&quot;,
  },
  &quot;devDependencies&quot;: {
    &quot;@babel/cli&quot;: &quot;^7.8.4&quot;,
    &quot;@babel/core&quot;: &quot;^7.9.0&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.9.5&quot;,
    &quot;@babel/preset-react&quot;: &quot;^7.9.4&quot;,
    &quot;babel-eslint&quot;: &quot;^8.2.6&quot;,
    &quot;eslint&quot;: &quot;^4.19.1&quot;
  }</code></pre><p>最终生成的 package.json 中至少要满足存在如上包，否则复制并执行 <code>npm install</code> 。</p><p>在博客根目录创建 <code>gulpfile.js</code> 并将以下内容复制粘贴到 gulofile.js 中</p><pre><code>let gulp = require(&#39;gulp&#39;)
let cleanCSS = require(&#39;gulp-clean-css&#39;)
let htmlmin = require(&#39;gulp-htmlmin&#39;)
let htmlclean = require(&#39;gulp-htmlclean&#39;)
let babel = require(&#39;gulp-babel&#39;) /* 转换为es2015 */
let uglify = require(&#39;gulp-uglify&#39;)
let imagemin = require(&#39;gulp-imagemin&#39;)

// 设置根目录
const root = &#39;./public&#39;

// 匹配模式， **/*代表匹配所有目录下的所有文件
const pattern = &#39;**/*&#39;

// 压缩html
gulp.task(&#39;minify-html&#39;, function() {
  return gulp
    // 匹配所有 .html结尾的文件
    .src(`${root}/${pattern}.html`)
    .pipe(htmlclean())
    .pipe(
      htmlmin({
        removeComments: true,
        minifyJS: true,
        minifyCSS: true,
        minifyURLs: true
      })
    )
    .pipe(gulp.dest(&#39;./public&#39;))
})

// 压缩css
gulp.task(&#39;minify-css&#39;, function() {
  return gulp
    // 匹配所有 .css结尾的文件
    .src(`${root}/${pattern}.css`)
    .pipe(
      cleanCSS({
        compatibility: &#39;ie8&#39;
      })
    )
    .pipe(gulp.dest(&#39;./public&#39;))
})

// 压缩js
gulp.task(&#39;minify-js&#39;, function() {
  return gulp
    // 匹配所有 .js结尾的文件
    .src(`${root}/${pattern}.js`)
    .pipe(
      babel({
        presets: [&#39;@babel/preset-env&#39;]
      })
    )
    .pipe(uglify())
    .pipe(gulp.dest(&#39;./public&#39;))
})

// 压缩图片
gulp.task(&#39;minify-images&#39;, function() {
  return gulp
    // 匹配public/images目录下的所有文件
    .src(`${root}/images/${pattern}`)
    .pipe(
      imagemin(
        [
          imagemin.gifsicle({ optimizationLevel: 3 }),
          imagemin.jpegtran({ progressive: true }),
          imagemin.optipng({ optimizationLevel: 7 }),
          imagemin.svgo()
        ],
        { verbose: true }
      )
    )
    .pipe(gulp.dest(&#39;./public/images&#39;))
})

gulp.task(&#39;default&#39;, gulp.series(&#39;minify-html&#39;, &#39;minify-css&#39;, &#39;minify-js&#39;))</code></pre><p>完成之后可使用 hexo g 生成静态文件并执行 gulp 检查是否能够运行。</p><h2 id="再说故事"><a href="#再说故事" class="headerlink" title="再说故事"></a>再说故事</h2><p>很早就使用过 gulp 来压缩静态资源， 最近一次重装系统，之后 gulp 就不能再使用了，于是我又再网上搜起了教程，网上清一色的都是远古教程，没有最近更新能用的，就来一周之内的能用的也没有找到一个，坚信着只要不放弃，就一定能解决问题的信念，我在网上找到了许多教程</p><p>终于有一个，能运行，虽然不能顺利压缩 js 资源，但是 css 和 html 都可以正常压缩，我现在提供的这份 gulpfile.js 也是参照那位大佬所写的，而我唯一跟他不同的也只有第 52 行代码。</p><pre><code>presets: [&#39;env&#39;] #这是那位大佬的</code></pre><pre><code>presets: [&#39;@babel/preset-env&#39;] #这是我的</code></pre><p>确实相差不大，不过也正是这一点不同才导致了一些 js 资源无法正常压缩<br>如果照着那位大佬写的话，会报以下错误</p><pre><code class="shell">[16:29:18] TypeError in plugin &quot;gulp-babel&quot;
Message:
    /home/tniasu/documents/blog/public/js/app.js: Cannot read property &#39;bindings&#39; of null
[16:29:18] &#39;default&#39; errored after 1.72 s</code></pre><p>搜索可知道这是因为压缩 js 需要 babel 编译打包的参与，而安装的 webpack版本没有与babel版本对应，否则即使配置项exclude配置了node_modules也可能会报错。<br>修改参数即可<br>总之，问题顺利的解决了，使用了 gulp 压缩了静态资源，不知道是不是心理作用，确实是幸福了不少！</p><ul><li><strong>参考自:</strong><ul><li><a href="https://clearsky.me/hexo-gulp-compress.html" target="_blank" rel="noopener">VoidKing博客：使用 gulp 压缩 hexo 静态资源</a></li><li><a href="https://stackoverflow.com/questions/52092739/upgrade-to-babel-7-cannot-read-property-bindings-of-null" target="_blank" rel="noopener">stackoverflow</a></li></ul></li></ul></article><div class="nexmoe-post-meta nexmoe-rainbow"> <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E4%BD%95%E4%B8%BA%E6%8A%98%E8%85%BE/">何为折腾</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/gulp/" rel="tag">gulp</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/hexo/" rel="tag">hexo</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/%E5%8A%A0%E9%80%9F/" rel="tag">加速</a></div><div class="nexmoe-post-footer"><div class="nexmoe-post-copyright"> <strong>本文作者：</strong>TniAsu<br> <strong>本文链接：</strong><a href="https://ventoso.top/posts/51356.html" title="https:&#x2F;&#x2F;ventoso.top&#x2F;posts&#x2F;51356.html" target="_blank" rel="noopener">https:&#x2F;&#x2F;ventoso.top&#x2F;posts&#x2F;51356.html</a><br> <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可，转载请表明出处</div><section class="nexmoe-comment"><div class="valine"></div><script src="https://cdn.jsdelivr.net/npm/valine@1.3.9/dist/Valine.min.js"></script><script>new Valine({el:".valine",appId:"S7HBVjrmhqipzhKE7Y5TCrgk-gzGzoHsz",appKey:"YNsurlMwYQ8TtcwNY6aXXOPU"})</script></section></div></div></div></div><script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js,gh/nexmoe/nexmoe.github.io@latest/js/app.js"></script><script>hljs.initHighlightingOnLoad()</script><script src="//instant.page/3.0.0" type="module" defer="defer" integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script></body></html>